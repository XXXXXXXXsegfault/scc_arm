void *memcpy(void *dst,void *src,unsigned int size);
asm "@memcpy"
asm "ldm sp,{r0,r1,r2}"
asm "stmdb sp!,{r4,r5,r6,r7,r8,r9,r10}"
asm "cmp r2,#4"
asm "bcc @__memcpy_A2"
asm "sub r3,r0,r1"
asm "tst r3,#3"
asm "bne @__memcpy_unaligned"
asm "tst r0,#1"
asm "ldrbne r3,[r1],#1"
asm "strbne r3,[r0],#1"
asm "subne r2,r2,#1"
asm "tst r0,#2"
asm "ldrhne r3,[r1],#2"
asm "strhne r3,[r0],#2"
asm "subne r2,r2,#2"
asm "@__memcpy_A1"
asm "subs r2,r2,#32"
asm "ldmiacs r1!,{r3,r4,r5,r6,r7,r8,r9,r10}"
asm "stmiacs r0!,{r3,r4,r5,r6,r7,r8,r9,r10}"
asm "bhi @__memcpy_A1"
asm "tst r2,#16"
asm "ldmiane r1!,{r3,r4,r5,r6}"
asm "stmiane r0!,{r3,r4,r5,r6}"
asm "tst r2,#8"
asm "ldmiane r1!,{r3,r4}"
asm "stmiane r0!,{r3,r4}"
asm "tst r2,#4"
asm "ldrne r3,[r1],#4"
asm "strne r3,[r0],#4"
asm "tst r2,#2"
asm "ldrhne r3,[r1],#2"
asm "strhne r3,[r0],#2"
asm "tst r2,#1"
asm "ldrbne r3,[r1]"
asm "strbne r3,[r0]"

asm "ldmia sp!,{r4,r5,r6,r7,r8,r9,r10}"
asm "ldr r0,[sp]"
asm "bx lr"

asm "@__memcpy_A2"
asm "cmp r2,#0"
asm "beq @__memcpy_A3"
asm "cmp r2,#2"
asm "ldrbhi r3,[r1],#1"
asm "strbhi r3,[r0],#1"
asm "ldrbcs r3,[r1],#1"
asm "strbcs r3,[r0],#1"
asm "ldrb r3,[r1],#1"
asm "strb r3,[r0],#1"

asm "@__memcpy_A3"
asm "ldmia sp!,{r4,r5,r6,r7,r8,r9,r10}"
asm "ldr r0,[sp]"
asm "bx lr"

asm "@__memcpy_unaligned"
asm "tst r3,#1"
asm "bne @__memcpy_unaligned2"
asm "tst r1,#1"
asm "ldrbne r3,[r1],#1"
asm "strbne r3,[r0],#1"
asm "subne r2,r2,#1"
asm "tst r1,#2"
asm "ldrhne r3,[r1],#2"
asm "strhne r3,[r0],#2"
asm "subne r2,r2,#2"
asm "subs r2,r2,#16"
asm "bcc @__memcpy_U2"
asm "@__memcpy_U1"
asm "ldmia r1!,{r3,r4,r5,r6}"
asm "add r7,r0,#2"
asm "strh r3,[r0],#4"
asm "strh r4,[r0],#4"
asm "strh r5,[r0],#4"
asm "strh r6,[r0],#4"
asm "lsr r3,r3,#16"
asm "lsr r4,r4,#16"
asm "lsr r5,r5,#16"
asm "lsr r6,r6,#16"
asm "strh r3,[r7],#4"
asm "strh r4,[r7],#4"
asm "strh r5,[r7],#4"
asm "strh r6,[r7]"
asm "subs r2,r2,#16"
asm "bcs @__memcpy_U1"
asm "@__memcpy_U2"
asm "tst r2,#8"
asm "beq @__memcpy_U3"
asm "ldmia r1!,{r3,r4}"
asm "add r7,r0,#2"
asm "strh r3,[r0],#4"
asm "strh r4,[r0],#4"
asm "lsr r3,r3,#16"
asm "lsr r4,r4,#16"
asm "strh r3,[r7],#4"
asm "strh r4,[r7]"
asm "@__memcpy_U3"
asm "tst r2,#4"
asm "ldrne r3,[r1],#4"
asm "strhne r3,[r0],#2"
asm "lsrne r3,r3,#16"
asm "strhne r3,[r0],#2"
asm "tst r2,#2"
asm "ldrhne r3,[r1],#2"
asm "strhne r3,[r0],#2"
asm "tst r2,#1"
asm "ldrbne r3,[r1]"
asm "strbne r3,[r0]"

asm "ldmia sp!,{r4,r5,r6,r7,r8,r9,r10}"
asm "ldr r0,[sp]"
asm "bx lr"

asm "@__memcpy_unaligned2"
asm "tst r1,#1"
asm "ldrbne r3,[r1],#1"
asm "strbne r3,[r0],#1"
asm "subne r2,r2,#1"
asm "tst r1,#2"
asm "ldrhne r3,[r1],#2"
asm "strbne r3,[r0],#1"
asm "lsrne r3,r3,#8"
asm "strbne r3,[r0],#1"
asm "subne r2,r2,#2"
asm "subs r2,r2,#16"
asm "bcc @__memcpy_U22"
asm "@__memcpy_U21"
asm "ldmia r1!,{r3,r4,r5,r6}"
asm "add r7,r0,#1"
asm "add r8,r0,#3"
asm "strb r3,[r0],#4"
asm "strb r4,[r0],#4"
asm "strb r5,[r0],#4"
asm "strb r6,[r0],#4"
asm "lsr r3,r3,#8"
asm "lsr r4,r4,#8"
asm "lsr r5,r5,#8"
asm "lsr r6,r6,#8"
asm "strh r3,[r7],#4"
asm "strh r4,[r7],#4"
asm "strh r5,[r7],#4"
asm "strh r6,[r7]"
asm "lsr r3,r3,#16"
asm "lsr r4,r4,#16"
asm "lsr r5,r5,#16"
asm "lsr r6,r6,#16"
asm "strb r3,[r8],#4"
asm "strb r4,[r8],#4"
asm "strb r5,[r8],#4"
asm "strb r6,[r8]"
asm "subs r2,r2,#16"
asm "bcs @__memcpy_U21"
asm "@__memcpy_U22"
asm "tst r2,#8"
asm "beq @__memcpy_U23"
asm "ldmia r1!,{r3,r4}"
asm "add r7,r0,#1"
asm "add r8,r0,#3"
asm "strb r3,[r0],#4"
asm "strb r4,[r0],#4"
asm "lsr r3,r3,#8"
asm "lsr r4,r4,#8"
asm "strh r3,[r7],#4"
asm "strh r4,[r7]"
asm "lsr r3,r3,#16"
asm "lsr r4,r4,#16"
asm "strb r3,[r8],#4"
asm "strb r4,[r8]"
asm "@__memcpy_U23"
asm "tst r2,#4"
asm "ldrne r3,[r1],#4"
asm "strbne r3,[r0],#1"
asm "lsrne r3,r3,#8"
asm "strhne r3,[r0],#2"
asm "lsrne r3,r3,#16"
asm "strbne r3,[r0],#1"
asm "tst r2,#2"
asm "ldrhne r3,[r1],#2"
asm "strbne r3,[r0],#1"
asm "lsrne r3,r3,#8"
asm "strbne r3,[r0],#1"
asm "tst r2,#1"
asm "ldrbne r3,[r1]"
asm "strbne r3,[r0]"

asm "ldmia sp!,{r4,r5,r6,r7,r8,r9,r10}"
asm "ldr r0,[sp]"
asm "bx lr"


void *memset(void *mem,int val,unsigned int size);
asm "@memset"
asm "ldm sp,{r0,r1,r2}"
asm "stmdb sp!,{r4,r5,r6}"
asm "and r1,r1,#0xff"
asm "orr r1,r1,r1,lsl #8"
asm "orr r1,r1,r1,lsl #16"
asm "cmp r2,#4"
asm "bcc @__memset_X1"
asm "tst r0,#1"
asm "strbne r1,[r0],#1"
asm "subne r2,r2,#1"
asm "tst r0,#2"
asm "strhne r1,[r0],#2"
asm "subne r2,r2,#2"
asm "mov r4,r1"
asm "mov r5,r1"
asm "mov r6,r1"
asm "@__memset_X2"
asm "subs r2,r2,#64"
asm "stmiacs r0!,{r1,r4,r5,r6}"
asm "stmiacs r0!,{r1,r4,r5,r6}"
asm "stmiacs r0!,{r1,r4,r5,r6}"
asm "stmiacs r0!,{r1,r4,r5,r6}"
asm "bhi @__memset_X2"
asm "tst r2,#32"
asm "stmiane r0!,{r1,r4,r5,r6}"
asm "stmiane r0!,{r1,r4,r5,r6}"
asm "tst r2,#16"
asm "stmiane r0!,{r1,r4,r5,r6}"
asm "tst r2,#8"
asm "stmiane r0!,{r1,r4}"
asm "tst r2,#4"
asm "strne r1,[r0],#4"
asm "and r2,r2,#3"
asm "@__memset_X1"
asm "cmp r2,#0"
asm "beq @__memset_X3"
asm "cmp r2,#2"
asm "strbhi r1,[r0],#1"
asm "strbcs r1,[r0],#1"
asm "strb r1,[r0]"
asm "@__memset_X3"
asm "ldmia sp!,{r4,r5,r6}"
asm "ldr r0,[sp]"
asm "bx lr"


int memcmp(void *mem1,void *mem2,unsigned int size);
asm "@memcmp"
asm "ldm sp,{r0,r1,r2}"
asm "str r4,[sp,#-4]!"
asm "mov r3,#0"
asm "subs r2,r2,#4"
asm "bcc @__memcmp_X3"
asm "@__memcmp_X1"
asm "ldrb r3,[r0],#1"
asm "ldrb r4,[r1],#1"
asm "subs r3,r3,r4"
asm "bne @__memcmp_X2"
asm "ldrb r3,[r0],#1"
asm "ldrb r4,[r1],#1"
asm "subs r3,r3,r4"
asm "bne @__memcmp_X2"
asm "ldrb r3,[r0],#1"
asm "ldrb r4,[r1],#1"
asm "subs r3,r3,r4"
asm "bne @__memcmp_X2"
asm "ldrb r3,[r0],#1"
asm "ldrb r4,[r1],#1"
asm "subs r3,r3,r4"
asm "bne @__memcmp_X2"
asm "subs r2,r2,#4"
asm "bcs @__memcmp_X1"
asm "@__memcmp_X3"
asm "tst r2,#2"
asm "beq @__memcmp_X4"
asm "ldrb r3,[r0],#1"
asm "ldrb r4,[r1],#1"
asm "subs r3,r3,r4"
asm "bne @__memcmp_X2"
asm "ldrb r3,[r0],#1"
asm "ldrb r4,[r1],#1"
asm "subs r3,r3,r4"
asm "bne @__memcmp_X2"
asm "@__memcmp_X4"
asm "tst r2,#1"
asm "ldrbne r3,[r0],#1"
asm "ldrbne r4,[r1],#1"
asm "subne r3,r3,r4"
asm "@__memcmp_X2"
asm "ldr r4,[sp],#4"
asm "mov r0,r3"
asm "bx lr"

unsigned int strlen(char *str);
asm "@strlen"
asm "ldr r1,[sp]"
asm "mov r0,r1"
asm "@__strlen_X1"
asm "ldrb r2,[r1],#1"
asm "cmp r2,#0"
asm "ldrbne r2,[r1],#1"
asm "cmpne r2,#0"
asm "ldrbne r2,[r1],#1"
asm "cmpne r2,#0"
asm "ldrbne r2,[r1],#1"
asm "cmpne r2,#0"
asm "bne @__strlen_X1"
asm "sub r0,r1,r0"
asm "sub r0,r0,#1"
asm "bx lr"


unsigned int strnlen(char *str,unsigned int max)
{
	unsigned int l;
	if(max==0)
	{
		return 0;
	}
	--max;
	l=0;
	while(*str&&l<max)
	{
		++l;
		++str;
	}
	return l;
}
int strcmp(char *str1,char *str2)
{
	unsigned int l1,l2;
	l1=strlen(str1);
	l2=strlen(str2);
	if(l1>l2)
	{
		l1=l2;
	}
	return memcmp(str1,str2,l1+1);
}
int strncmp(char *str1,char *str2,unsigned int max)
{
	unsigned int l1,l2;
	l1=strnlen(str1,max);
	l2=strnlen(str2,max);
	if(l1>l2)
	{
		l1=l2;
	}
	return memcmp(str1,str2,l1+1);
}
